---
title: "STA13824 - Análise de regressão"
subtitle: "Inferência no modelo de regressão linear - II"
author: "<br/><br/>"
institute: "LECON/DEST - UFES"
date: "Vitória, ES. - `r format(Sys.Date(), format='%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    includes:
      after_body: insert-logo.html
    css: [xaringan-themer.css, "https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css"]
    lib_dir: libs
    nature:
      ratio: '16:9' 
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

class: animated, fadeIn
```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer); library(dplyr); library("DT"); library(plotly) #library(icons)
style_mono_light(base_color = "#23395b")
```
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```
```{r, load_refs, include=FALSE, cache=FALSE}
library("RefManageR"); library("bibtex")
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = "authoryear",
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)
myBib <- ReadBib("ref_ementa.bib", check = FALSE)
```

<style> body {text-align: justify} </style> <!-- Justify text. -->

### Algumas propriedades do estimador de MQO - I

Considere o modelo é linear, dado por

$$Y=\mathbf{X\,\beta}+\mathbf{\epsilon}.$$
Pelas Suposições **A1** e **A2**, o estimador de MQO para $\mathbf{\beta}$ é 
dado por

$$\mathbf{\widehat{\beta}}=\left(\mathbf{X}'\mathbf{X}\right)^{-1}\mathbf{X}'Y.$$
> Pelas Suposições **A1-A3**, o estimador MQO é não-viesado para $\mathbf{\beta}$, i.e.,
$\mathbb{E}\left[\widehat{\mathbf{\beta}}\,\big|\,\mathbf{X}\right]=\mathbf{\beta}$;

> Pelas Suposições **A1-A4**, $\textrm{cov}\left[\widehat{\beta}\,\big|\,\mathbf{X}\right]=\sigma^2\left(\mathbf{X}'\mathbf{X}\right)^{-1}$;

> Pelas Suposições **A1-A5**, o parâmetro $\sigma^2$ pode ser estimado com
$$QM_{Res}=\frac{SQ_{Res}}{n-p},$$
onde $SQ_{Res}=Y'\left(\mathbf{I}-\mathbf{H}\right)Y$ e $p=k+1$. Onde, 
$\frac{SQ_{Res}}{\sigma^2}$ segue uma distribuição $\chi^2_{n-p}$.


---
class: animated, slideInRight

### Algumas propriedades do estimador de MQO - II

Assumindo as suposições **A1-A4** temos que

* Os valores ajustados são obtidos como $\widehat{Y}=\mathbf{X}\widehat{\beta}$,
onde $\widehat{\beta}$ é a solução do sistema de equações normais. Uma outra
representação dos valores ajustados é dada pela matriz de projeção 
$\widehat{Y}=\mathbf{H}Y$, onde $\mathbf{H}=\mathbf{X}(\mathbf{X'X})^{-1}\mathbf{X}'$.

* O vetor de resíduos é dado por $e=Y-\widehat{Y}=(\mathbf{I}-\mathbf{H})Y$;

* O vetor $Y$ pode ser representado como a soma de duas componentes **ortogonais**, 
uma componente de projeção (*ajustado*) e uma componente residual, i.e.,

$$Y=\mathbf{H}Y+\left(\mathbf{I}-\mathbf{H}\right)Y.$$
> Isso significa que, o produto interno entre o vetor de valores ajustados e o
vetor de resíduos é zero, i.e., $\langle\widehat{Y},e\rangle=\langle e,\widehat{Y}\rangle=0$. 
Em outras palavras, os vetores são ortogonais;


Para detalhes ver, por exemplo, `r Citet(myBib, "chatterjee:hadi:2006")`,
`r Citet(myBib, "draper:smith:1998")` e `r Citet(myBib, "montgomery2006")`.


---
class: animated, slideInRight

### Análise de variância (ANOVA) - I

Usando o teorema de Pitágoras,

$$Y'Y=Y'\mathbf{H}'\mathbf{H}Y+Y'\left(\mathbf{I}-\mathbf{H}\right)'\left(\mathbf{I}-\mathbf{H}\right)Y=\widehat{Y}'\widehat{Y}+e'e$$
ou

$$SQ_{Total}=SQ_{Reg}+SQ_{Res}.$$
> Observe que, a soma de quadrados da regressão, dada por
$$SQ_{Reg}=Y'\mathbf{H}'\mathbf{H}Y=Y'\mathbf{H}Y=Y'\mathbf{X}(\mathbf{X'X})^{-1}\mathbf{X}'Y.$$

Pelas Suposições **A1-A5**, temos que

$$\frac{SQ_{Reg}}{\sigma^2}=\frac{1}{\sigma^2}Y'\mathbf{H}Y$$
segue uma distribuição $\chi^2$ não-central, cujos graus de liberdade são iguais 
ao posto da matriz $\mathbf{H}$. Observe que, pelo fato de ser idempotente, 
o posto da matriz é igual ao seu traço.


---
class: animated, slideInRight

### Análise de variância (ANOVA) - II

* O traço da matriz $\mathbf{H}$ é dado por

$$\mathrm{tr}\left(\mathbf{H}\right)=\mathrm{tr}\left(\mathbf{X}\left(\mathbf{X}'\mathbf{X}\right)^{-1}\mathbf{X}'\right)=\mathrm{tr}\left(\mathbf{X}'\mathbf{X}\left(\mathbf{X}'\mathbf{X}\right)^{-1}\right)=p,$$
onde $\mathbf{X}'\mathbf{X}$ é de dimensão $p\times p$, onde $p=k+1$.


* O parâmetro de não-centralidade é dado por

$$\frac{1}{\sigma^2}\mathbb{E}[Y']\mathbf{H}\mathbb{E}[Y]=\frac{1}{\sigma^2}\beta'\mathbf{X}'\mathbf{H}\mathbf{X}\beta=\frac{1}{\sigma^2}\beta'\mathbf{X}'\mathbf{X}\beta.$$
Dessa forma,

$$\frac{SQ_{Reg}}{\sigma^2}=\frac{1}{\sigma^2}Y'\mathbf{H}Y$$
segue uma distribuição $\chi^2_{p,\lambda}$, onde $\lambda=\frac{1}{\sigma^2}\beta'\mathbf{X}'\mathbf{X}\beta$.


---
class: animated, fadeIn

### Análise de variância (ANOVA) - III

> As formas quadráticas $Y'\left(\mathbf{I}-\mathbf{H}\right)Y$ e $Y'\mathbf{H}Y$
são independentes, pois $\left(\mathbf{I}-\mathbf{H}\right)\mathbf{H}=\mathbf{0}$.

Dessa forma,

$$F=\frac{\frac{SQ_{Reg}}{p\sigma^2}}{\frac{SQ_{Res}}{(n-p)\sigma^2}}=\frac{QM_{Reg}}{QM_{Res}}$$
segue uma distribuição $F_{p,n-p,\lambda}$, com $\lambda=\frac{1}{\sigma^2}\beta'\mathbf{X}'\mathbf{X}\beta$.

--

Dessa relação, podemos construir uma tabela básica para a **Análise de Variância**:


 | Fonte        | Graus de liberdade |        Somas de quadrados         | Quadrados médios  |
 |:------------:|:------------------:|:---------------------------------:|:-----------------:|
 |    Regressão |         $p$        | $\widehat{\beta}'\mathbf{X}'Y$    |  $QM_{Reg}$       |
 |     Resíduos |       $n-p$        | $Y'Y-\widehat{\beta}'\mathbf{X}'Y$|  $QM_{Res}$       |
 |              |                    |                                   |                   |
 |        Total |         $n$        |        $Y'Y$                      |                   |
 

---
class: animated, slideInRight

### Coeficiente de determinação - $R^2$

Da relação $SQ_{Total}=SQ_{Reg}+SQ_{Res}$, temos que

$$1=\frac{SQ_{Reg}}{SQ_{Total}}+\frac{SQ_{Res}}{SQ_{Total}}.$$
Daí,

$$\frac{SQ_{Reg}}{SQ_{Total}}=1-\frac{SQ_{Res}}{SQ_{Total}}.$$
Define-se o *coeficiente de determinação* como a quantidade 
$\frac{SQ_{Reg}}{SQ_{Total}}$ e denota-se como $R^2$. 

A interpretação do $R^2$  é naturalmente percebida  como  a  proporção  da
variação  total  de $Y$ explicada  pela  variação  nas variáveis regressoras.
Em outras palavras, o $R^2$ expressa a quantidade da variância dos dados que 
é explicada pelo modelo linear. Dessa forma, quanto maior o coeficiente, mais 
explicativo é o modelo linear.


---
class: animated, fadeIn

### Coeficiente de determinação - $R^2$

#### Algumas considerações

1. O $R^2$ está definido no intervalo $[0,1]$. Na prática, uma realização do $R^2$
próxima de $1$ indica que o modelo apresenta um "*bom*" ajuste para os dados, embora as 
interpretações de ajuste dependam do contexto de análise.

--

2. Na prática, o $R^2$ deve ser utilizado com cautela, pois sempre é possível 
aumentar seu valor esperado adicionando termos suficientes ao modelo. 

--

3. Embora $R^2$ não possa diminuir se adicionarmos uma variável regressora ao 
modelo, este não significa necessariamente que o novo modelo seja superior ao 
antigo;

--

4. A magnitude de $R^2$ também depende da faixa de variabilidade da variável regressora. 
Geralmente $R^2$ aumentará o valor das suas realizações conforme a aumenta a
variabilidade das regressoras e viceversa, desde que a forma do modelo assumido esteja correta.

--

5. Sob algumas condições de regularidade, o $R^2$ segue distribuição
$Beta\left(\frac{k}{2},\frac{n-k-1}{2}\right)$, 
onde $k$ é o número de regressores e $n$ o tamanho de amostra. 

---
class: inverse, hide-logo, middle, center

# Máxima verossimilhança

---
class: animated, slideInRight

### Estimador de máxima verossimilhança para $\beta$

Considere o modelo é linear, dado por

$$Y=\mathbf{X\,\beta}+\mathbf{\epsilon}.$$
Pelas Suposições **A1-A5**, temos que

$$L\left(\beta, \sigma^2\right)=\frac{1}{(2\pi)^{n/2}\sigma^n}\exp\left\{-\frac{1}{2\sigma^2}\left(Y-\mathbf{X}\beta\right)'\left(Y-\mathbf{X}\beta\right)\right\},$$
daí,

$$\log L\left(\beta, \sigma^2\right)=-\frac{n}{2}\log(2\pi)-n\log(\sigma)-\frac{1}{2\sigma^2}\left(Y-\mathbf{X}\beta\right)'\left(Y-\mathbf{X}\beta\right).$$
Observe que, para um $\sigma$ fixo, a log-verossimilhança é maximizada quando o 
termo $\left(Y-\mathbf{X}\beta\right)'\left(Y-\mathbf{X}\beta\right)$ é minimizado.
Dessa forma, o estimador de máxima verossimilhança para $\beta$ é equivalente
ao estimador de mínimos quadrados. Ainda, o estimador de máxima verossimilhança
para $\sigma^2$ é dado por

$$\widetilde{\sigma}^2=\frac{\left(Y-\mathbf{X}\widehat{\beta}\right)'\left(Y-\mathbf{X}\widehat{\beta}\right)}{n}.$$

---
class: animated, lightSpeedIn
# Referências

```{r refs, echo=FALSE, results="asis"}
PrintBibliography(myBib, .opts = list(check.entries = FALSE))
```

---
class: animated, hide-logo, bounceInDown
## Política de proteção aos direitos autorais

> <span style="color:grey">O conteúdo disponível consiste em material protegido pela legislação brasileira, sendo certo que, por ser
o detentor dos direitos sobre o conteúdo disponível na plataforma, o **LECON** e o **NEAEST** detém direito
exclusivo de usar, fruir e dispor de sua obra, conforme Artigo 5<sup>o</sup>, inciso XXVII, da Constituição Federal
e os Artigos 7<sup>o</sup> e 28<sup>o</sup>, da Lei 9.610/98.
A divulgação e/ou veiculação do conteúdo em sites diferentes à plataforma e sem a devida autorização do
**LECON** e o **NEAEST**, pode configurar violação de direito autoral, nos termos da Lei 9.610/98, inclusive podendo
caracterizar conduta criminosa, conforme Artigo 184<sup>o</sup>, §1<sup>o</sup> a 3<sup>o</sup>, do Código Penal.
É considerada como contrafação a reprodução não autorizada, integral ou parcial, de todo e qualquer
conteúdo disponível na plataforma.</span>

.pull-left[
```{r, out.width='50%', fig.align='center', fig.cap='',echo=FALSE}
knitr::include_graphics("images/logo_lecon.png")
```
]
.pull-right[
```{r, out.width='50%', fig.align='center', fig.cap='',echo=FALSE}
knitr::include_graphics("images/logo_neaest.png")
```
]
<br></br>
.center[
[https://lecon.ufes.br](https://lecon.ufes.br/) &emsp; &emsp;  &emsp; &emsp; [https://analytics.ufes.br](https://analytics.ufes.br)
]

<font size="2"><span style="color:grey">Material elaborado pela equipe LECON/NEAEST: 
Alessandro J. Q. Sarnaglia, Bartolomeu Zamprogno, Fabio A. Fajardo, Luciana G. de Godoi 
e Nátaly A. Jiménez.</span></font>
