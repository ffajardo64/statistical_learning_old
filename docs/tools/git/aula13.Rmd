---
title: "STA13824 - Análise de regressão"
subtitle: "Violação de suposições: Linearidade"
author: "<br/><br/>"
institute: "LECON/DEST - UFES"
date: "Vitória, ES. - `r format(Sys.Date(), format='%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    includes:
      after_body: ["insert-logo.html"]
    css: [xaringan-themer.css, "https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css"]
    lib_dir: libs
    nature:
      ratio: '16:9' 
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

class: animated, fadeIn
```{r xaringan-themer, include=FALSE, warning=FALSE}
library("xaringanthemer"); library("dplyr"); library("DT"); library("plotly")
style_mono_light(base_color = "#23395b")
```
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```
```{r, load_refs, include=FALSE, cache=FALSE}
library("RefManageR"); library("bibtex")
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = "authoryear",
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)
myBib <- ReadBib("ref_ementa.bib", check = FALSE)
```

<style> body {text-align: justify} </style> <!-- Justify text. -->

### A1. Linearidade - I

A hipótese da linearidade do modelo de regressão linear clássico é diretamente 
relacionada com a forma funcional da função de regressão, dada por

$$\mathbb{E}[Y|\mathbf{X}]=\mathbf{X}\beta,$$
i.e., existe um vetor $\beta$ tal que a equação acima é válida. Esta suposição é 
fundamental, pois se não for satisfeita isto significa que não temos uma regressão 
linear. Nesse caso, a relação entre $Y$ e $\mathbf{X}$ é de natureza não-linear.

> Lembrando que a **linearidade nos parâmetros** é fundamental para o 
desenvolvimento teórico realizado até agora.

Quando analisamos funções não-lineares dos parâmetros e modelos de regressão 
não-linear, a maioria dos resultados obtidos até agora não são mais válidos. 



<br></br>

Para detalhes `r Citet(myBib, "greene:2007")` e `r Citet(myBib, "krammer:1986")`.

---
class: animated, slideInRight

### A1. Linearidade - II

O problema geral é testar uma hipótese que envolve uma função não-linear dos 
coeficientes de regressão:

$$H_0: c(\beta)=q.$$
Uma estatística de teste que pode-se usar para avaliar a hipótese acima é dada 
por $z=\frac{c(\widehat{\beta})-q}{\mathrm{dp}\left(c\left(\widehat{\beta}\right)\right)},$
onde $\mathrm{dp}$ representa o desvio-padrão. A estatística $z$ segue uma 
distribuição $t_{n-p}$.

> Observe que estimativa da variância de $c\left(\widehat{\beta}\right)-q$, 
envolve a variância de uma função não-linear de $\widehat{\beta}$.

A aproximação da variância é realizada por meio da aproximação em série de Taylor
de primeiro grau, tal que 

$$c\left(\widehat{\beta}\right)\approx c(\beta)+\left(\frac{\partial c(\beta)}{\partial\beta}\right)'\left(\widehat{\beta}-\beta\right).$$
Dessa forma,

$$\mathrm{var}\left[c\left(\widehat{\beta}\right)\right]\approx \left(\frac{\partial c(\beta)}{\partial\beta}\right)'\mathrm{var}\left(\widehat{\beta}\right)\left(\frac{\partial c(\beta)}{\partial\beta}\right).$$

---
class: animated, slideInRight

### A1. Linearidade - III

#### Teste RESET (_Regression Specification Error Test_)

`r Citet(myBib, "ramsey:1969")` Tests for Specification Errors in Classical Linear Least-Squares 
Regression Analysis, Journal of the Royal Statistical Society. Series B (Methodological), 
Vol. 31, No. 2, pp. 350-371.

$$H_0: Y=\mathbf{X}\beta+\epsilon\qquad H_1: Y=\mathbf{X}\beta+\mathbf{Z}\gamma+\epsilon$$
ou

$$H_0: ``\text{O modelo está bem especificado}"\qquad H_1: ``\text{O modelo está mal especificado}".$$
Os elementos da matriz $\mathbf{Z}$ podem ser potências do $\widehat{Y}$ ou das 
colunas de $\mathbf{X}$. Nesse caso, $\mathbf{Z}$ tem dimensão $n\times q.$

Sob $H_0$, a estatística de teste para determinar se essas variáveis adicionais 
influenciam significativamente segue uma distribuição $F_{q,n-p-q}$.

No `R`, use a função `lmtest::resettest`

```{r,echo=FALSE}
args(lmtest::resettest)
```

---
class: animated, slideInRight

### A1. Linearidade - IV

#### Teste arco-íris (_rainbow test_)

`r Citet(myBib, "utts:1982")` The Rainbow Test for Lack of Fit in Regression. 
Communications in Statistics – Theory and Methods 11, 2801–2815.

> De acordo com a autora, o nome do teste é supostamente para cobrir um amplo 
espectro de possíveis problemas, além da não-linearidade.

A ideia básica por trás do teste arco-íris é que mesmo quando a verdadeira relação 
é não-linear, um bom ajuste linear ainda pode ser obtido em subconjuntos da amostra. 
Rejeita-se a hipótese nula sempre que o ajuste geral é significativamente pior 
do que o ajuste para a sub-amostra. 


> **Ideia**: As somas de quadrados dos resíduos das duas regressões devem ser
próximas.


---
background-image: url("images/rainbow1.png")
background-size: contain

class: animated, slideInRight
### Teste arco-íris (_rainbow test_) 

<br></br>
$\hspace{10cm} R^2=0.62$

<br></br><br></br><br></br><br></br><br></br><br></br>

$\color{blue}{\left(Y\quad \mathbf{X}\right)}$: $n$ observações completas

---
background-image: url("images/rainbow2.png")
background-size: contain

class: animated, fadeIn
### Teste arco-íris (_rainbow test_)

<br></br>
$\hspace{10cm} R^2=0.89$

<br></br><br></br><br></br><br></br><br></br><br></br>

$\color{blue}{\left(\underset{\sim}{Y_1}\quad \mathbf{X_1}\right)}$: $n_1$ observações (subamostra)

---
class: animated, slideInRight

### Teste arco-íris (_rainbow test_)

<div class="math">
\[
  \begin{aligned}
  \left[
  \begin{array}{c}
  \underset{\sim}{Y_1} \\
  \underset{\sim}{Y_2}
  \end{array}
  \right]&=
  \left[
  \begin{array}{c}
  \mathbf{X_1} \\
  \mathbf{X_2}
  \end{array}
  \right]\beta+
  \left[
  \begin{array}{c}
  \mathbf{0} \\
  \mathbf{I}_{n-n_1}
  \end{array}
  \right]\gamma+
  \left[
  \begin{array}{c}
  \epsilon_1 \\
  \epsilon_2
  \end{array}
  \right]
  \end{aligned}
\]
</div>

Dessa forma,

$$H_0: \gamma=0\qquad H_1: \gamma\ne0$$
ou

$$H_0: ``\text{linearidade}"\qquad H_1: ``\text{não-linearidade}".$$
Sob $H_0$, a estatística de teste para verificar linearidade segue uma 
distribuição $F_{n-n_1,n_1-p}$.


No `R`, use a função `lmtest::raintest`

```{r,echo=FALSE}
args(lmtest::raintest)
```

---
class: animated, slideInRight

### A1. Linearidade - V

#### Teste Harvey-Collier

`r Citet(myBib, "harvey:1977")` Testing for functional misspecification in regression analysis. 
Journal of Econometrics 6, 103–119.

A opção alternativa do teste Rainbow é o teste Harvey-Collier. Sob $H_0$, estatística de 
teste segue uma distribuição $t_{n-p-1}$ e a mesma é função dos resíduos [recursivos](https://ffajardo64.github.io/statistical_learning/STA13824/aula9.html#13). 

Se a relação verdadeira não for linear, mas convexa (ou côncava), a média dos 
resíduos recursivos deve ser significativamente diferenete de zero. Um resultado 
estatisticamente significativo significa que podemos rejeitar $H_0$, i.e., o 
modelo é linear.


No `R`, use a função `lmtest::harvtest`

```{r,echo=FALSE}
args(lmtest::harvtest)
```

A função `strucchange::recresid` calcula os resíduos recursivos.

---
class: animated, slideInRight

### A1. Linearidade - VI

#### Teste Chow para mudança estrutural

Chow, G. C. (1960) Tests of equality between sets of coefficients in two linear regressions. Econometrica, 28:591–605, 1960.

O teste de Chow é usado para testar se os coeficientes verdadeiros em duas 
regressões lineares em conjuntos de dados diferentes são iguais. O teste é
semelhante ao teste arco-íris, nesse caso $n_1$ é o ponto em que foi identificada
a mudança estrutural.

No `R`, use a função `strucchange::Fstats`

```{r,echo=FALSE}
args(strucchange::Fstats)

```

Também existe as função `strucchange::sctest` e `strucchange::breakpoints`. 
Para detalhes, Zeileis A.,  Leisch F., Hornik K., Kleiber C. (2002), 
[An R Package for Testing for Structural Change in Linear Regression Models](file:///tmp/strucchange.pdf).

---
class: animated, slideInRight

### Modelos intrinsecamente lineares

#### Modelo linear vs modelo log-linear

Os modelos log-lineares ilustram um caso intermediário de um modelo de regressão 
não-linear. Considere

$$Y_i=\alpha X_i^{\beta_1}\exp\{\epsilon_i\},$$
daí

$$\log Y_i=\log\alpha +\beta_1\log  X_i+\epsilon_i$$
ou

$$Y'_i =\beta_0 +\beta_1X'_i+\epsilon_i.$$
O teste de Box-Cox permite avaliar a equivalência do modelo linear com o modelo
log-linear. Dessa forma, considere as seguintes hipóteses

$$H_0: ``\text{Os modelos são equivalentes}"\qquad H_1: ``\text{Os modelos não são equivalentes}".$$
---
class: animated, slideInRight

### Modelos intrinsecamente lineares

#### Modelo linear vs modelo log-linear

O teste de Box-Cox consiste no seguinte:

1. Calcule a média geométrica de $Y_1,Y_2,\ldots,Y_n$, ou seja $\bar{Y}_G=\sqrt{\prod_{i=1}^nY_i}$;
1. Sejam $SQ_{Res_L}$ e $SQ_{Res_{LL}}$ as somas de quadrados resíduais para os modelos linear e log_linear, respectivamente; 
1. O teste compara $SQ_{Res_{LL}}$ e $\frac{SQ_{Res_{L}}}{\bar{Y}_G^2}$. Sob $H_0$, 
a estatística 

$$l=\frac{n}{2}\left|\log\frac{\frac{SQ_{Res_{L}}}{\bar{Y}_G^2}}{SQ_{Res_{LL}}}\right|$$
segue uma distribuição $\chi_{(1)}^2$.

---
class: animated, slideInRight

### Modelos intrinsecamente lineares

#### Modelo linear vs modelo log-linear

Outra alternativa é o teste de MacKinnon-White-Davidson (PE) para comparar 
especificações lineares e log-lineares em regressões lineares.

No `R`, use a função `lmtest::petest`

```{r,echo=FALSE}
args(lmtest::petest)

```


---
class: animated, lightSpeedIn
# Referências

```{r refs, echo=FALSE, results="asis"}
PrintBibliography(myBib, .opts = list(check.entries = FALSE))
```

---
class: animated, hide-logo, bounceInDown
## Política de proteção aos direitos autorais

> <span style="color:grey">O conteúdo disponível consiste em material protegido pela legislação brasileira, sendo certo que, por ser
o detentor dos direitos sobre o conteúdo disponível na plataforma, o **LECON** e o **NEAEST** detém direito
exclusivo de usar, fruir e dispor de sua obra, conforme Artigo 5<sup>o</sup>, inciso XXVII, da Constituição Federal
e os Artigos 7<sup>o</sup> e 28<sup>o</sup>, da Lei 9.610/98.
A divulgação e/ou veiculação do conteúdo em sites diferentes à plataforma e sem a devida autorização do
**LECON** e o **NEAEST**, pode configurar violação de direito autoral, nos termos da Lei 9.610/98, inclusive podendo
caracterizar conduta criminosa, conforme Artigo 184<sup>o</sup>, §1<sup>o</sup> a 3<sup>o</sup>, do Código Penal.
É considerada como contrafação a reprodução não autorizada, integral ou parcial, de todo e qualquer
conteúdo disponível na plataforma.</span>

.pull-left[
```{r, out.width='50%', fig.align='center', fig.cap='',echo=FALSE}
knitr::include_graphics("images/logo_lecon.png")
```
]
.pull-right[
```{r, out.width='50%', fig.align='center', fig.cap='',echo=FALSE}
knitr::include_graphics("images/logo_neaest.png")
```
]
<br></br>
.center[
[https://lecon.ufes.br](https://lecon.ufes.br/) &emsp; &emsp;  &emsp; &emsp; [https://analytics.ufes.br](https://analytics.ufes.br)
]

<font size="2"><span style="color:grey">Material elaborado pela equipe LECON/NEAEST: 
Alessandro J. Q. Sarnaglia, Bartolomeu Zamprogno, Fabio A. Fajardo, Luciana G. de Godoi 
e Nátaly A. Jiménez.</span></font>
