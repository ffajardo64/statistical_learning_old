---
title: "STA13824 - Análise de regressão"
subtitle: "Inferência no modelo de regressão linear - III"
author: "<br/><br/>"
institute: "LECON/DEST - UFES"
date: "Vitória, ES. - `r format(Sys.Date(), format='%d/%m/%Y')`"
output:
  xaringan::moon_reader:
    includes:
      after_body: insert-logo.html
    css: [xaringan-themer.css, "https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css"]
    lib_dir: libs
    nature:
      ratio: '16:9' 
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

class: animated, fadeIn
```{r xaringan-themer, include=FALSE, warning=FALSE}
library("xaringanthemer"); library("dplyr"); library("DT"); library("plotly")
style_mono_light(base_color = "#23395b")
```
```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```
```{r, load_refs, include=FALSE, cache=FALSE}
library("RefManageR"); library("bibtex")
BibOptions(check.entries = FALSE,
           bib.style = "authoryear",
           cite.style = "authoryear",
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)
myBib <- ReadBib("ref_ementa.bib", check = FALSE)
```

<style> body {text-align: justify} </style> <!-- Justify text. -->

### Análise de variância (ANOVA) - I

Considere o modelo é linear, dado por

$$Y=\mathbf{X\,\beta}+\mathbf{\epsilon}.$$
Pelas Suposições **A1** e **A2**, o estimador de MQO para $\mathbf{\beta}$ é 
dado por

$$\mathbf{\widehat{\beta}}=\left(\mathbf{X}'\mathbf{X}\right)^{-1}\mathbf{X}'Y.$$
> Pelas Suposições **A1-A3**, o estimador MQO é não-viesado para $\mathbf{\beta}$, i.e.,
$\mathbb{E}\left[\widehat{\mathbf{\beta}}\,\big|\,\mathbf{X}\right]=\mathbf{\beta}$;

> Pelas Suposições **A1-A4**, $\textrm{cov}\left[\widehat{\beta}\,\big|\,\mathbf{X}\right]=\sigma^2\left(\mathbf{X}'\mathbf{X}\right)^{-1}$;

> Pelas Suposições **A1-A5**, o parâmetro $\sigma^2$ pode ser estimado com
$$QM_{Res}=\frac{SQ_{Res}}{n-p},$$
onde $SQ_{Res}=Y'\left(\mathbf{I}-\mathbf{H}\right)Y$ e $p=k+1$. Onde, 
$\frac{SQ_{Res}}{\sigma^2}=\frac{1}{\sigma^2}\left[Y'(\mathbf{I}-\mathbf{H})Y\right]$ 
segue uma distribuição $\chi^2_{n-p}$.


---
class: animated, slideInRight

### Análise de variância (ANOVA) - II

> Pelas Suposições **A1-A5**, 
$$\frac{SQ_{Reg}}{\sigma^2}=\frac{1}{\sigma^2}Y'\mathbf{H}Y$$
segue uma distribuição $\chi^2_{p,\lambda}$, onde 
$\lambda=\frac{1}{\sigma^2}\beta'\mathbf{X}'\mathbf{X}\beta$. Daí, 
$$QM_{Reg}=\frac{SQ_{Reg}}{p}.$$



Dessa forma, podemos construir uma tabela básica para a **Análise de Variância**, 
dada por:


 | Fonte        | Graus de liberdade |        Somas de quadrados         | Quadrados médios  |
 |:------------:|:------------------:|:---------------------------------:|:-----------------:|
 |    Regressão |         $p$        | $\widehat{\beta}'\mathbf{X}'Y$    |  $QM_{Reg}$       |
 |     Resíduos |       $n-p$        | $Y'Y-\widehat{\beta}'\mathbf{X}'Y$|  $QM_{Res}$       |
 |              |                    |                                   |                   |
 |        Total |         $n$        |        $Y'Y$                      |                   |
 


---
class: animated, slideInRight

### Mais resultados de interesse - I

* Pelas Suposições **A1-A5**, o vetor $Y$ segue uma distribuição 
**normal $n$-variada** com vetor de médias $\mathbb{E}[Y]=\mathbf{X}\beta$ e 
matriz de covarianciâs $\mathrm{cov}[Y]=\sigma^2\mathbf{I}$;

> **Lembre que**: Se $X$ é um vetor com distribuição $N_m(\mu,\Sigma)$ e $\mathbf{B}$
uma matriz $k\times m$ e $b$ um vetor $k\times 1$, então $Y=\mathbf{B}X+b$ segue
uma distribuição $N_k\left(\mathbf{B}\mu,\mathbf{B}\Sigma\mathbf{B}'\right)$. Para detalhes ver, e.g., `r Citet(myBib, "muirhead2005")`.

* Pelas Suposições **A1-A5**, o vetor $\widehat{Y}$ segue uma distribuição 
**normal $n$-variada** com vetor de médias 
$\mathbf{E}\left[\widehat{Y}\right]=\mathbf{X}\beta$ e matriz de 
covariâncias $\mathrm{cov}\left[\widehat{Y}\right]=\sigma^2\mathbf{H}$.

***

<span style="color:grey">
Calculando o valor esperado de $\widehat{Y}$:

$$\mathbb{E}\left[\widehat{Y}\right]=\mathbb{E}\left[\mathbf{H}Y\right]=\mathbf{H}\,\mathbb{E}\left[Y\right]=\mathbf{HX}\beta=\mathbf{X}\beta.$$
</span>

<span style="color:grey">
Calculando a matriz de covariâncias de $\widehat{Y}$:

$$\mathrm{cov}\left[\widehat{Y}\right]=\mathbf{X}\mathrm{cov}\left[\widehat{\beta}\right]\mathbf{X}'=\sigma^2\mathbf{X}\left(\mathbf{X}'\mathbf{X}\right)^{-1}\mathbf{X}'=\sigma^2\mathbf{H}.$$
</span>

---
class: animated, slideInRight

### Mais resultados de interesse - II

* Pelas Suposições **A1-A5**, o vetor de *resíduos* segue uma distribuição 
**normal $n$-variada** com vetor de médias $0$ e matriz de 
covariâncias $\mathrm{cov}\left[e\right]=\sigma^2\left(\mathbf{I}-\mathbf{H}\right)$.

  <span style="color:grey">
    Calculando o valor esperado do vetor de resíduos:
  
  $$\mathbb{E}\left[e\right]=\mathbb{E}\left[\left(\mathbf{I}-\mathbf{H}\right)Y\right]=\left(\mathbf{I}-\mathbf{H}\right)\mathbb{E}\left[Y\right]=\left(\mathbf{I}-\mathbf{H}\right)\mathbf{X}\beta=0.$$
  </span>
  
  <span style="color:grey">
  Calculando a matriz de covariâncias do vetor de resíduos:

$$\mathrm{cov}\left[e\right]=\mathrm{cov}\left[\left(\mathbf{I}-\mathbf{H}\right)Y\right]=\left(\mathbf{I}-\mathbf{H}\right)\mathrm{cov}\left[Y\right]\left(\mathbf{I}-\mathbf{H}\right)'=\sigma^2\left(\mathbf{I}-\mathbf{H}\right).$$ 
</span>

**<span style="color:red">Exercício:</span>**
Considere o modelo $Y=\mathbf{X}\beta+\epsilon$, onde $\epsilon$ é um vetor com
distribuição normal $n$-variada com vetor de médias $0$ e matriz de covariâncias
$\sigma^2\mathbf{I}$. Seja

<div class="math">
\[\mathbf{U}=\left[
\begin{array}{c}
\widehat{\beta} \\
e \\
\end{array}
\right]=
\left[
\begin{array}{c}
\left(\mathbf{X}'\mathbf{X}\right)^{-1}\mathbf{X}' \\
\left(\mathbf{I}-\mathbf{H}\right) \\
\end{array}
\right]Y.
\]
</div>

1. Qual a distribuição de $\mathbf{U}?$;
1. Mostre que $\widehat{\beta}$ e $e$ são independentes.

---
class: animated, slideInRight

### Testes de hipóteses e intervalos de confiança para $\beta$ - I

Sabemos que $\widehat{\beta}_j$ segue uma distribuição normal com média $\beta_j$ 
e variância $\sigma^2\, C_{jj}$, onde $C_{jj}$ é o $j+1$-ésimo elemento diagonal
da matriz $\left(\mathbf{X}'\mathbf{X}\right)^{-1}$. Dessa forma,

$$Z=\frac{\widehat{\beta}_j-\beta_j}{\sqrt{\sigma^2C_{jj}}}$$
segue uma distribuição normal padrão.

Ainda, temos que $\frac{SQ_{Res}}{\sigma^2}$ segue uma distribuição $\chi^2_{n-p}$. Daí,

$$t=\frac{Z}{\sqrt{\frac{SQ_{Res}}{\sigma^2(n-p)}}}=\frac{\frac{\widehat{\beta}_j-\beta_j}{\sqrt{\sigma^2C_{jj}}}}{\sqrt{\frac{QM_{Res}}{\sigma^2}}}=\frac{\widehat{\beta}_j-\beta_j}{\sqrt{QM_{Res}\, C_{jj}}}$$
segue uma distribuição $t_{n-p}$.

---
class: animated, slideInRight

### Testes de hipóteses e intervalos de confiança para $\beta$ - I

#### Intervalos de confiança

Dessa forma, $t$ é uma quantidade pivotal para o parâmetro $\beta_j$. Daí, um
intervalo de $(1-\alpha)\times 100\%$ de confiança para $\beta_j$ é dado por

$$\widehat{\beta}_j\pm t_{1-\alpha/2,n-p}\sqrt{QM_{Res}\, C_{jj}}.$$
#### Teste de hipóteses

Considere as seguintes hipóteses

  <div class="math">
  $$
  \begin{aligned}
  H_0&:\beta_j=0 & H_1&:\beta_j\ne0.
  \end{aligned}
  $$
  </div>

Seja $t_0$ que representa a quantidade pivotal $t$ sob $H_0$. Assim, $t_0$ segue
uma distribuição $t_{n-p}$.

Rejeitamos $H_0$, em favor de $H_1$, se $|t_0|>t_{1-\alpha/2,n-p}$.


---
class: inverse, hide-logo, middle, center

# Correção da soma de quadrados

---
class: animated, slideInRight

### Análise de variância (ANOVA) - III

#### Algumas considerações

* A soma de quadrados total (*não-corrigida*) foi particionada na soma de 
quadrados devido ao modelo de regressão e a soma de quadrados dos resíduos

$$Y'Y = \widehat{Y}'\widehat{Y}+e'e=\widehat{\beta}'\mathbf{X}'Y+e'e.$$
* Eventualmente teremos interesse em explicar a variação de $Y$ em torno da 
sua média (ao invés do em torno de zero) e determinar com quanta informação as 
covariáveis contribuem para tal explicação. 

  > **Caso 1.** Se nenhuma informação das covariáveis estiver disponível, o 
  melhor preditor de $Y$ é a melhor estimativa disponível da média da população. 
  Nesse sentido,
  $$\mathbb{E}\left[Y|\mathbf{X}\right]=\beta_0,$$
  daí, $\widehat{\beta}_0=\bar{Y}$;
 
 
---
class: animated, fadeIn

### Análise de variância (ANOVA) - IV

> **Caso 2.** Quando as covariáveis estão disponíveis, ou seja
$$\mathbb{E}\left[Y|\mathbf{X}\right]=\mathbf{X}\beta,$$
o interesse está em saber com quanta informação as covariáveis contribuem para a 
explicação da variação de $Y$, além da contribuição fornecida apenas pela média 
de $Y$.

Dessa forma, a informação adicional fornecida pelas covariáveis será representada
como 
$$SQ_{Reg} = SQ_{Modelo} - SQ_{\mu},$$
onde $SQ_{Modelo}$ representa a soma de quadrados da regressão quando as
covariáveis **estão** disponíveis, e $SQ_{\mu}$ representa a soma de quadrados da 
regressão quando **nenhuma** covariável está disponível. O modelo sem covariáveis 
contém apenas um único parâmetro, nesse caso a média geral $\mu$.

<br></br>

--

.center[
<font size="6"> Objetivo: Comparar os Casos 1 e 2.</font>
]


---
class: animated, slideInRight

### Análise de variância (ANOVA) - V

O modelo quando $\mu$ é o único parâmetro é dado por

$$Y=\mathbf{X\,\beta}+\mathbf{\epsilon},$$
onde $\mathbf{X}$ é um o vetor coluna de $1's$, denotado por $\mathbf{1}$, e 
$\beta=\mu$. Daí,

$$\widehat{\beta}=\left(\mathbf{1}'\mathbf{1}\right)^{-1}\mathbf{1}'Y=\frac{1}{n}\mathbf{1}'Y=\bar{Y}$$
e

$$SQ_{\mu}=\widehat{\beta}'\mathbf{X}'Y=\frac{1}{n}\left(\mathbf{1}'Y\right)'\left(\mathbf{1}'Y\right)=Y'\left(\frac1n\mathbf{11}'\right)Y=Y'\left(\frac1n\mathbf{J}\right)Y.$$
> Uma outra forma para representar $SQ_\mu$ é dada por 
$$SQ_\mu=\frac1n\left(\sum_{i=1}^nY_i\right)^2=n\bar{Y}^2.$$

---
class: animated, slideInRight

### Análise de variância (ANOVA) - V

A matriz $\frac1n\mathbf{J}$ é dada por
 
<div class="math">
\[\frac1n\mathbf{J}=\frac1n\mathbf{11}'=\frac1n\left[
\begin{array}{ccccc}
1&1&1&\cdots&1 \\
1&1&1&\cdots&1 \\
\vdots&\vdots&\vdots&\ddots&\vdots\\
1&1&1&\cdots&1
\end{array}
\right]_{n\times n}.
\]
</div>

Pode-se observar que a matriz $\frac1n\mathbf{J}$ é idempotente, daí o posto é igual a 
$\mathrm{tr}\left(\frac1n\mathbf{J}\right)=1$. Dessa forma, a forma quadrática

$$\frac{SQ_{\mu}}{\sigma^2}=\frac{1}{\sigma^2}Y'\left(\frac1n\mathbf{J}\right)Y$$
segue uma distribuição $\chi^2_{1,\lambda}$, com 

$$\lambda=\frac{1}{\sigma^2}\beta'\mathbf{X}'\left(\frac1n\mathbf{J}\right)\mathbf{X}\beta=\frac{1}{n\sigma^2}\left(\mathbf{X}\beta\right)'\mathbf{1}\mathbf{1}'\mathbf{X}\beta=\frac{1}{n\sigma^2}\left(\mathbf{1}'\mathbf{X}\beta\right)^2.$$
---
class: animated, slideInRight

### Análise de variância (ANOVA) - V

A $SQ_{Reg}$ é dada por

$$SQ_{Reg}=SQ_{Modelo}-SQ_\mu=Y'\mathbf{H}Y-Y'\left(\frac1n\mathbf{J}\right)Y=Y'\left(\mathbf{H}-\frac1n\mathbf{J}\right)Y.$$
Dessa forma, $\frac{SQ_{Reg}}{\sigma^2}=\frac{1}{\sigma^2}Y'\left(\mathbf{H}-\frac1n\mathbf{J}\right)Y$
segue uma distribuição $\chi^2_{p-1,\lambda}$, com

$$\lambda=\frac{1}{\sigma^2}\beta'\mathbf{X}'\left(\mathbf{H}-\frac1n\mathbf{J}\right)\mathbf{X}\beta=\frac{1}{\sigma^2}\beta'\mathbf{X}'\left(\mathbf{I}-\frac1n\mathbf{J}\right)\mathbf{X}\beta.$$
<br></br>

**<span style="color:red">Exercício:</span>** Mostre que a matriz $\frac1n\mathbf{J}$
é ortogonal às matrizes $\mathbf{H}-\frac1n\mathbf{J}$ e $\mathbf{I}-\mathbf{H}$.



---
class: animated, slideInRight

### Análise de variância (ANOVA) - V

Dessa forma, a soma de quadrados total pode ser particionada em três componentes
tal que

$$Y'Y=SQ_\mu+SQ_{Reg}+SQ_{Res}=Y'\left(\frac1n\mathbf{J}\right)Y+Y'\left(\mathbf{H}-\frac1n\mathbf{J}\right)Y+Y'\left(\mathbf{I}-\mathbf{H}\right)Y.$$
Dessa forma, podemos construir uma tabela para a **Análise de Variância**, com a
soma de quadrados corrigida, dada por:


 | Fonte        | Graus de liberdade |  Somas de quadrados  | Quadrados médios  |
 |:------------:|:------------------:|:--------------------:|:-----------------:|
 |    Regressão |         $p-1$        | $SQ_{Reg}$         |  $QM_{Reg}$       |
 |     Resíduos |         $n-p$        | $SQ_{Res}$         |  $QM_{Res}$       |
 |              |                      |                    |                   |
 |        Total |         $n-1$        | $SQ_{Total}$       |                   |
 

---
class: animated, slideInRight

### Teste de significância da regressão

O teste de significância da regressão permite verificar se existe uma relação 
linear entre a variável dependente $Y$ e as covariáveis.

Considere as seguintes hipóteses

  <div class="math">
  $$
  \begin{aligned}
  H_0&:\beta_1=\beta_2=\beta_3=\cdots=\beta_k=0 & H_1&:\text{algum }\beta_j\ne0, \quad j=1,2,\ldots,k.
  \end{aligned}
  $$
A rejeição de $H_0$ implica que pelo menos uma das covariáveis contribui ao modelo.

Sob $H_0$,

$$F_0=\frac{SQ_{Reg}/(p-1)}{SQ_{Res}/(n-p)}=\frac{QM_{Reg}}{QM_{Res}}$$
segue uma distribuição $F_{p-1,n-p}$. Rejeitamos $H_0$ se $F_0>F_{p-1,n-p,\alpha}$.

> O coeficiente de determinação ajustado define-se como
$$R^2_{Ajust}=1-\frac{SQ_{Res}/(n-p)}{SQ_{Total}/(n-1)}.$$

---
class: animated, lightSpeedIn
# Referências

```{r refs, echo=FALSE, results="asis"}
PrintBibliography(myBib, .opts = list(check.entries = FALSE))
```

---
class: animated, hide-logo, bounceInDown
## Política de proteção aos direitos autorais

> <span style="color:grey">O conteúdo disponível consiste em material protegido pela legislação brasileira, sendo certo que, por ser
o detentor dos direitos sobre o conteúdo disponível na plataforma, o **LECON** e o **NEAEST** detém direito
exclusivo de usar, fruir e dispor de sua obra, conforme Artigo 5<sup>o</sup>, inciso XXVII, da Constituição Federal
e os Artigos 7<sup>o</sup> e 28<sup>o</sup>, da Lei 9.610/98.
A divulgação e/ou veiculação do conteúdo em sites diferentes à plataforma e sem a devida autorização do
**LECON** e o **NEAEST**, pode configurar violação de direito autoral, nos termos da Lei 9.610/98, inclusive podendo
caracterizar conduta criminosa, conforme Artigo 184<sup>o</sup>, §1<sup>o</sup> a 3<sup>o</sup>, do Código Penal.
É considerada como contrafação a reprodução não autorizada, integral ou parcial, de todo e qualquer
conteúdo disponível na plataforma.</span>

.pull-left[
```{r, out.width='50%', fig.align='center', fig.cap='',echo=FALSE}
knitr::include_graphics("images/logo_lecon.png")
```
]
.pull-right[
```{r, out.width='50%', fig.align='center', fig.cap='',echo=FALSE}
knitr::include_graphics("images/logo_neaest.png")
```
]
<br></br>
.center[
[https://lecon.ufes.br](https://lecon.ufes.br/) &emsp; &emsp;  &emsp; &emsp; [https://analytics.ufes.br](https://analytics.ufes.br)
]

<font size="2"><span style="color:grey">Material elaborado pela equipe LECON/NEAEST: 
Alessandro J. Q. Sarnaglia, Bartolomeu Zamprogno, Fabio A. Fajardo, Luciana G. de Godoi 
e Nátaly A. Jiménez.</span></font>
